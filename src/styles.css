@import url("tldraw/tldraw.css");

/*
	!!! Please prefix all custom classes with 'ptl' !!!

	Any classes prefixed with 'ptl' is a custom class (stands for plugin-tldraw).
	Any classes prefixed with 'tl' or 'tlui' is a class from the official Tldraw app.
	Any other classes is most likely from Obsidian.

	Obsidian's button:not(.clickable-icon) is a troublesome selector/style. Since we do
	not have control of Tldraw's underlying components and styles, we cannot just add
	".clickable-icon" to all of Tldraw's buttons. We could add the classes manually using
	native javascript APIs but we would be affecting the DOM directly which could cause problems
	with Tldraw's react tree. The only solution I see is when there's a problematic override of
	Tldraw's styles by Obsidian's button:not(.clickable-icon) is find the styles that are
	affected (usually only background-color, box-shadow, and padding) and find what those styles
	should be (classes prefixed with 'tl' or 'tlui' then find a way to increase the specificity over button:not(.clickable-icon) using selectors and paste in those styles. Look for the comments that start with 'OVERRIDING'.
*/

.tldraw-view-root {
	touch-action: none;
	position: relative;
	width: 100%;
	height: 100%;

	/* Prevents Obsidian from displaying their tooltips */
	--no-tooltip: true;

	/* Prevent watermark from causing scrollbars (use clip instead of hidden to not affect tooltip positioning) */
	overflow: clip;
}

/*
 * Fix tooltip positioning: Obsidian's workspace containers have CSS properties
 * that create new containing blocks for position:fixed elements.
 * We must reset these on ALL ancestor containers up to the workspace root.
 */
.workspace-split,
.workspace-tabs,
.workspace-tab-container,
.workspace-leaf,
.workspace-leaf-content,
div[data-type="tldraw-view"],
div[data-type="tldraw-read-only"],
div[data-type="tldraw-view"] > .view-content,
div[data-type="tldraw-read-only"] > .view-content {
	transform: none !important;
	filter: none !important;
	perspective: none !important;
	contain: none !important;
	will-change: auto !important;
	backdrop-filter: none !important;
}

/* OVERRIDING button:not(.clickable-icon) back to tldraw's original styles: */
.tldraw-view-root .tlui-button {
	background-color: transparent;
	color: currentColor;
	padding: 0px 12px;
	box-shadow: none;
}

/* Overriding back to original style */
.tldraw-view-root .tlui-button:disabled {
	color: var(--tl-color-text-3);
}

/* Overriding back to original style (v4 uses aria-pressed instead of aria-checked) */
.tldraw-view-root .tlui-button__tool[aria-pressed='true'] {
	color: var(--tl-color-selected-contrast);
}

.tldraw-view-root .ptl-quick-action-button-wrapper[data-selected=true] .tlui-button__icon {
	color: var(--tl-color-selected-contrast);
}

.tldraw-view-root .ptl-quick-action-button-wrapper[data-selected=true] .tlui-button::before {
	content: "";
	position: absolute;
	inset: 4px;
	border-radius: var(--tl-radius-2);
	background-color: var(--tl-color-selected);
}

/* OVERRIDING button:not(.clickable-icon) for help button */
.tldraw-view-root .tlui-button.tlui-button__help {
	background-color: var(--tl-color-low);
}

.tldraw-view-root kbd {
	background: inherit;
	border-radius: inherit;
	padding: inherit;
}

/* OVERRIDING Obsidian's CSS */
.tldraw-view-root ol > li::marker, .tldraw-view-root ul > li::marker {
	color: inherit;
}

div[data-type="tldraw-view"] .view-content.tldraw-view-content,
div[data-type="tldraw-read-only"] .view-content.tldraw-view-content {
	/* gets rid of the padding so the canvas can bleed against the edges */
	padding: 0;
	@container style(--status-bar-position: fixed) {
		/* creates a space at the bottom so that the status bar isn't covering the canvas */
		padding-bottom: calc(var(--size-4-1) * 2 + var(--status-bar-font-size) + 8px);
	}
}

.is-mobile div[data-type="tldraw-view"] .view-content.tldraw-view-content {
	/* There is a bit of padding that shows up on mobile which we can remove. */
	padding-bottom: 0;
}

.ptl-statusbar-viewmode-box {
	display: flex;
	align-items: center;
	gap: 4px;
}

.plugin-tldraw .ptl-statusbar-viewmode-box .ptl-viewmode-btn {
	background-color: transparent;
	padding: 0 4px;
	height: 12px;
	width: 22px;
	box-shadow: none;
	border-radius: 2px;

	display: grid;
	place-items: center;

	font-size: 8px;
	font-weight: 700;
	line-height: 8px;

	cursor: pointer;

	&:hover {
		background-color: var(--background-secondary-alt);
	}
}

.plugin-tldraw .ptl-statusbar-viewmode-box .ptl-viewmode-btn.ptl-viewmode-active {
	box-shadow: inset 0px 0px 0px 1px currentColor;
	border-radius: 4px;
}

.ptl-hide-statusbar-viewmode {
	display: none;
}

.ptl-statusbar-viewmode-btn-box {
	display: flex;
	align-items: center;
	gap: 2px;
}

.ptl-default-code {
	margin-top: 6px;
	display: block;
}

.tl-background {
	touch-action: none;
}

.status-bar-item.plugin-tldraw {
	background-color: var(--background-modifier-border);
}

.ptl-markdown-embed {
	position: relative;
}

.ptl-embed-context-bar {
	padding: 2px;
	display: flex;
	background: var(--background-primary-alt);
}

.ptl-embed-title-bar {
	font-size: var(--font-smallest);
	margin-left: 8px;
	align-self: center;
}

/* Render the context bar for embeds in the top right corner. */
.ptl-markdown-embed .ptl-embed-context-bar {
	display: flex;
	justify-content: space-between;
	width: 100%;
	position: absolute;
	top: 0;
}

.ptl-embed-action-bar {
	display: flex;
}

.ptl-markdown-embed .ptl-view-content .tldraw-view-root {
	height: 300px;
}

.ptl-markdown-embed .ptl-view-content[data-showBgDots="true"] {
	background-image:
		radial-gradient(rgb(78, 78, 78) 1px, transparent 1px),
		radial-gradient(rgb(78, 78, 78) 1px, transparent 1px);
	background-size: 48px 48px;
	/* Size of the grid cells */
	background-position: 0 0, 24px 24px;
	/* Offset for the dotted pattern */
}

.ptl-markdown-embed .ptl-view-content[data-has-shape="false"] .ptl-tldraw-image::before {
	display: block;
	content: "This is an empty tldraw file. Double click to edit in a new tab, or right click for options.";
	height: 100%;
	text-align: center;
	align-content: center;
}

.ptl-markdown-embed .ptl-tldraw-image-container {
	display: flex;
	justify-content: center;
}

.canvas-node .ptl-markdown-embed .ptl-tldraw-image {
	height: var(--canvas-node-height);
	width: var(--canvas-node-width);
}

.ptl-markdown-embed .ptl-tldraw-image {
	max-inline-size: max-content;
}

.ptl-markdown-embed .ptl-view-content {
	height: max-content;
}

.ptl-view-content:empty {
	min-width: var(--ptl-placeholder-width);
	min-height: var(--ptl-placeholder-height);
}

.ptl-tldraw-image:not(:has(div > img)) {
	min-width: var(--ptl-placeholder-width);
	min-height: var(--ptl-placeholder-height);
}

.ptl-markdown-embed .ptl-tldraw-image img {
	object-fit: contain;
}

.ptl-download-error {
	color: red;
}

.ptl-download-success {
	color: green;
}

.ptl-compare-modal {
	width: 100%;
	height: 100%;
}

.ptl-compare-modal-content {
	display: flex;
	flex-direction: column;
}

.ptl-conflict-body {
	flex: 1;
}

.ptl-compare-tldraw-container {
	display: flex;
	height: 100%;
	width: 100%;
	flex-direction: row;
	flex-wrap: wrap;
	gap: 2em;
}

.ptl-compare-tldraw-container .ptl-compare-tldraw {
	flex: 1;
	display: flex;
	flex-direction: column;
	min-width: 250px;
}

.ptl-compare-preview {
	height: 400px;
}

.ptl-modal-title-with-icon {
	padding-top: 12px;
	display: flex;
	flex-direction: row;
	gap: 0.25em;
	align-items: center;
}

.ptl-modal-title-with-icon span.ptl-modal-icon {
	display: contents;
}

.ptl-suggestion-item {
	display: flex;
	gap: 0.25em;
}

.ptl-suggestion-item-icon {
	display: contents;
}

.ptl-suggestion-label {
	font-size: x-small;
}

.ptl-embed-bounds-selection {
	position: absolute;
	top: 0;
	left: 0;
	z-index: 999;
}

.ptl-embed-bounds-selection[data-target-bounds="true"] {
	border: 1px solid var(--color-text-0);
}

.ptl-embed-bounds-selection[data-target-bounds="false"] {
	border: 1px dashed var(--color-text-0);
}

.ptl-embed-bounds-selection[data-shade-bg="true"]::before {
	position: absolute;
	content: "";
	display: block;
	width: 100%;
	height: 100%;
	background-color: var(--color-text-0);
	opacity: 0.15;
}

@media print {
	.ptl-markdown-embed {
		/* Prevent the embeds from being split across multiple pages */
		break-inside: avoid;
	}

	.ptl-markdown-embed .ptl-tldraw-image img {
		/* Prevent an embed from being larger than the print page size */
		max-height: 85vh;
	}

	.ptl-embed-resize-handle {
		display: none;
	}
}

.ptl-embed-resize-handle {
	position: absolute;
	bottom: 0;
	right: 0;
	width: 0;
	height: 0;
	border-style: solid;
	border-width: 0 0 16px 16px;
	border-color: transparent transparent var(--background-modifier-border) transparent;
	cursor: row-resize;
}

.ptl-settings-tab-header {
	display: flex;
	overflow-y: hidden;
}

.ptl-settings-tab-container {
	display: flex;
	gap: var(--size-4-2);
}

.ptl-settings-tab-container .ptl-settings-tab-item {
	font-weight: var(--font-semibold);
	padding-block: var(--size-2-3);
	padding-inline: var(--size-4-3);
	border-radius: var(--radius-m);
	width: max-content;
}

.ptl-settings-tab-container .ptl-settings-tab-item:hover {
	cursor: pointer;
}

.ptl-settings-tab-item[data-is-active=false]:hover {
    background-color: var(--interactive-hover);
}

.ptl-settings-tab-item[data-is-active=true] {
	background-color: var(--interactive-accent);
	color: var(--text-on-accent);
}

.ptl-settings-frontmatter-taglist {
	display: flex;
	flex-wrap: wrap;
	gap: var(--size-4-2);
}

.ptl-new-file-prefix-template-main .ptl-new-file-prefix-template-code {
	font-weight: var(--bold-weight);
	user-select: text;
}

.ptl-new-file-prefix-templates .ptl-new-file-prefix-template-children {
	padding: var(--size-4-1);
}

.ptl-new-file-prefix-templates .ptl-new-file-prefix-template-item {
	border: 1px solid var(--background-modifier-border);
	border-radius: var(--radius-m);
	padding: var(--size-4-2);
}

/* Copied from tldraw.com */
.tl-shape[data-shape-type="arrow"] .tl-text {
    height: max-content;
}

/* Copied from tldraw.com */
.tl-shape[data-shape-type="arrow"] .tl-text-label {
    position: absolute;
    top: -1px;
    left: -1px;
    width: 2px;
    height: 2px;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: var(--tl-color-text);
    text-shadow: var(--tl-text-outline);
}

/* Copied from tldraw.com */
.tl-shape[data-shape-type="arrow"] .tl-text-label__inner {
    height: max-content;
    box-sizing: content-box;
    border-radius: var(--tl-radius-1);
}

/* ============================================
   Layer Panel Styles
   ============================================ */

/* Layer Panel Container */
.ptl-layer-panel-wrapper {
	position: absolute;
	left: 8px;
	top: 90px;
	bottom: 60px;
	z-index: 300;
	pointer-events: all;
	display: flex;
	flex-direction: column;
	gap: 4px;
}

.ptl-layer-panel-toggle-btn {
	width: 32px;
	height: 32px;
	border-radius: var(--tl-radius-2);
	background: var(--tl-color-panel);
	box-shadow: var(--tl-shadow-2);
	border: none;
	outline: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-1);
	transition: background-color 0.15s ease;
}

.ptl-layer-panel-toggle-btn:hover {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

.ptl-layer-panel {
	width: 200px;
	flex: 1;
	min-height: 0;
	background: var(--tl-color-panel);
	display: flex;
	flex-direction: column;
	border-radius: var(--tl-radius-3);
	box-shadow: var(--tl-shadow-2);
	overflow: hidden;
}

.ptl-layer-panel-header {
	display: flex;
	align-items: center;
	padding: 8px 10px;
	border-bottom: 1px solid var(--tl-color-divider);
	background: var(--tl-color-panel);
	flex-shrink: 0;
}

.ptl-layer-panel-title {
	font-size: 12px;
	font-weight: 600;
	color: var(--tl-color-text);
}

.ptl-layer-panel-content {
	flex: 1;
	overflow-y: auto;
	overflow-x: hidden;
}

/* Shape Tree */
.ptl-shape-tree {
	display: flex;
	flex-direction: column;
}

/* Shape Item */
.ptl-shape-item {
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 6px 10px;
	cursor: pointer;
	transition: background-color 0.1s ease;
	color: var(--tl-color-text);
	min-height: 32px;
}

.ptl-shape-item:hover {
	background-color: var(--tl-color-muted-2);
}

/* Selected shape */
.ptl-shape-item-selected {
	background-color: var(--tl-color-selected);
	color: var(--tl-color-selected-contrast);
}

.ptl-shape-item-selected:hover {
	background-color: var(--tl-color-selected);
}

/* Child of selected shape (for hierarchy indication) */
.ptl-shape-item-child-selected {
	background-color: var(--tl-color-muted-1);
}

/* Hidden shape */
.ptl-shape-item-hidden {
	opacity: 0.5;
}

/* Shape Name */
.ptl-shape-name {
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	flex: 1;
	min-width: 0;
	font-size: 12px;
}

/* Shape Name Input (for renaming) */
.ptl-shape-name-input {
	border: none;
	background: var(--tl-color-background);
	width: 0;
	flex-grow: 1;
	padding: 2px 4px;
	font-size: 12px;
	color: var(--tl-color-text);
	border-radius: var(--tl-radius-2);
	outline: 1px solid var(--tl-color-selected);
}

.ptl-shape-name-input:focus {
	outline: 2px solid var(--tl-color-selected);
}

/* Visibility Toggle Button */
.ptl-shape-visibility-toggle {
	padding: 3px 6px;
	border-radius: var(--tl-radius-2);
	outline: none;
	border: none;
	background: none;
	flex-shrink: 0;
	color: var(--tl-color-text-1);
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
}

.ptl-shape-visibility-toggle:hover {
	background-color: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

/* Ensure visibility toggle stays visible even when shape item is selected */
.ptl-shape-item-selected .ptl-shape-visibility-toggle {
	color: var(--tl-color-selected-contrast);
}

.ptl-shape-item-selected .ptl-shape-visibility-toggle:hover {
	background-color: rgba(255, 255, 255, 0.2);
}

/* Override Obsidian button styles for layer panel buttons */
.tldraw-view-root .ptl-layer-panel button {
	background-color: transparent;
	box-shadow: none;
	padding: 3px 6px;
}

.tldraw-view-root .ptl-layer-panel-toggle-btn {
	background: var(--tl-color-panel);
	box-shadow: var(--tl-shadow-2);
}

.tldraw-view-root .ptl-layer-panel-toggle-btn:hover {
	background: var(--tl-color-muted-2);
}

/* ============================================
   Chat Panel Styles
   ============================================ */

/* Chat Panel Container - positioned on the left side, next to layer panel toggle */
.ptl-chat-panel-wrapper {
	position: absolute;
	left: 48px;
	top: 90px;
	bottom: 60px;
	z-index: 300;
	pointer-events: all;
	display: flex;
	flex-direction: column;
	gap: 4px;
}

.ptl-chat-panel-toggle-btn {
	width: 32px;
	height: 32px;
	border-radius: var(--tl-radius-2);
	background: var(--tl-color-panel);
	box-shadow: var(--tl-shadow-2);
	border: none;
	outline: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-1);
	transition: background-color 0.15s ease;
}

.ptl-chat-panel-toggle-btn:hover {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

.ptl-chat-panel {
	width: 350px;
	flex: 1;
	min-height: 0;
	background: var(--tl-color-panel);
	display: flex;
	flex-direction: column;
	border-radius: var(--tl-radius-3);
	box-shadow: var(--tl-shadow-2);
	overflow: hidden;
	font-family: 'Inter', sans-serif;
	font-size: 12px;
	line-height: 1.5;
	-webkit-user-select: text;
	user-select: text;
	cursor: auto;
}

.ptl-chat-panel-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 8px 10px;
	border-bottom: 1px solid var(--tl-color-divider);
	background: var(--tl-color-panel);
	flex-shrink: 0;
}

.ptl-chat-panel-title {
	font-size: 12px;
	font-weight: 600;
	color: var(--tl-color-text);
}

.ptl-chat-panel-close-btn {
	width: 24px;
	height: 24px;
	border-radius: var(--tl-radius-2);
	background: transparent;
	border: none;
	outline: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-1);
	transition: background-color 0.15s ease;
}

.ptl-chat-panel-close-btn:hover {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

/* Messages Area */
.ptl-chat-panel-messages {
	flex: 1;
	overflow-y: auto;
	overflow-x: hidden;
	padding: 12px;
	display: flex;
	flex-direction: column;
	gap: 12px;
}

.ptl-chat-panel-empty {
	display: flex;
	align-items: center;
	justify-content: center;
	height: 100%;
	color: var(--tl-color-text-2);
	font-size: 13px;
	text-align: center;
	padding: 20px;
}

.ptl-chat-panel-empty p {
	margin: 0;
	line-height: 1.5;
}

/* Chat Message Styles */
.ptl-chat-message {
	display: flex;
	max-width: 90%;
}

.ptl-chat-message-user {
	align-self: flex-end;
}

.ptl-chat-message-assistant {
	align-self: flex-start;
}

.ptl-chat-message-content {
	padding: 8px 12px;
	border-radius: var(--tl-radius-3);
	font-size: 13px;
	line-height: 1.5;
	word-wrap: break-word;
	overflow-wrap: break-word;
	-webkit-user-select: text;
	user-select: text;
	cursor: text;
}

.ptl-chat-message-user .ptl-chat-message-content {
	background: var(--tl-color-selected);
	color: var(--tl-color-selected-contrast);
	border-bottom-right-radius: var(--tl-radius-1);
}

.ptl-chat-message-assistant .ptl-chat-message-content {
	background: var(--tl-color-muted-1);
	color: var(--tl-color-text);
	border-bottom-left-radius: var(--tl-radius-1);
}

.ptl-chat-message-error .ptl-chat-message-content {
	background: rgba(239, 68, 68, 0.15);
	color: var(--text-error, #ef4444);
	border: 1px solid rgba(239, 68, 68, 0.3);
}

/* Code Styling */
.ptl-chat-code-block {
	background: var(--tl-color-background);
	border-radius: var(--tl-radius-2);
	padding: 8px 10px;
	margin: 8px 0;
	overflow-x: auto;
	font-family: var(--font-monospace);
	font-size: 12px;
	line-height: 1.4;
}

.ptl-chat-code-block code {
	background: none;
	padding: 0;
}

.ptl-chat-inline-code {
	background: var(--tl-color-background);
	padding: 2px 4px;
	border-radius: var(--tl-radius-1);
	font-family: var(--font-monospace);
	font-size: 0.9em;
}

/* Streaming Indicator */
.ptl-chat-streaming-indicator {
	display: inline-flex;
	align-items: center;
	gap: 3px;
	margin-left: 4px;
	vertical-align: middle;
}

.ptl-chat-streaming-dot {
	width: 4px;
	height: 4px;
	border-radius: 50%;
	background: var(--tl-color-text-2);
	animation: ptl-chat-pulse 1.4s infinite ease-in-out both;
}

.ptl-chat-streaming-dot:nth-child(1) {
	animation-delay: -0.32s;
}

.ptl-chat-streaming-dot:nth-child(2) {
	animation-delay: -0.16s;
}

@keyframes ptl-chat-pulse {
	0%, 80%, 100% {
		transform: scale(0.6);
		opacity: 0.5;
	}
	40% {
		transform: scale(1);
		opacity: 1;
	}
}

/* Action Notification (for agent actions like create, delete, etc.) */
.ptl-chat-action-notification {
	display: flex;
	align-items: center;
	gap: 6px;
	padding: 4px 10px;
	background: var(--tl-color-muted-0);
	border-radius: var(--tl-radius-2);
	font-size: 11px;
	color: var(--tl-color-text-2);
	align-self: center;
}

.ptl-chat-action-type {
	text-transform: capitalize;
	font-weight: 500;
}

/* Generating Indicator (shown while agent is processing) */
.ptl-chat-generating {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 4px;
	padding: 8px;
	align-self: flex-start;
}

.ptl-chat-generating-dot {
	font-size: 8px;
	color: var(--tl-color-text-2);
	animation: ptl-chat-pulse 1.4s infinite ease-in-out both;
}

.ptl-chat-generating-dot:nth-child(1) {
	animation-delay: -0.32s;
}

.ptl-chat-generating-dot:nth-child(2) {
	animation-delay: -0.16s;
}

/* Input Area */
.ptl-chat-panel-input-area {
	display: flex;
	flex-direction: column;
	padding: 10px;
	background: var(--tl-color-panel);
	flex-shrink: 0;
}

.ptl-chat-input-container {
	display: flex;
	flex-direction: column;
	gap: 8px;
	background: var(--tl-color-background);
	border-radius: var(--tl-radius-3);
	padding: 8px;
	border: 1px solid var(--tl-color-divider);
	transition: border-color 0.15s ease;
}

.ptl-chat-input-container:focus-within {
	border-color: var(--tl-color-selected);
}

/* Input row with textarea and submit button */
.ptl-chat-input-row {
	display: flex;
	align-items: flex-end;
	gap: 8px;
}

.ptl-chat-input-textarea {
	flex: 1;
	border: none;
	outline: none;
	background: transparent;
	resize: none;
	font-size: 13px;
	line-height: 1.5;
	color: var(--tl-color-text);
	min-height: 20px;
	max-height: 120px;
	padding: 2px 0;
	font-family: inherit;
	scrollbar-width: thin;
	scrollbar-color: var(--tl-color-muted-1) transparent;
}

.ptl-chat-input-textarea::-webkit-scrollbar {
	width: 8px;
	background: transparent;
}

.ptl-chat-input-textarea::-webkit-scrollbar-track {
	background: transparent;
}

.ptl-chat-input-textarea::-webkit-scrollbar-thumb {
	background: var(--tl-color-muted-1);
	border-radius: 4px;
}

.ptl-chat-input-textarea::placeholder {
	color: var(--tl-color-text-2);
}

.ptl-chat-input-textarea:disabled {
	opacity: 0.5;
	cursor: not-allowed;
}

.ptl-chat-input-actions {
	display: flex;
	align-items: center;
	gap: 4px;
	flex-shrink: 0;
}

.ptl-chat-input-btn {
	width: 28px;
	height: 28px;
	border-radius: var(--tl-radius-2);
	background: transparent;
	border: none;
	outline: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-1);
	transition: all 0.15s ease;
}

.ptl-chat-input-btn:hover:not(:disabled) {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

.ptl-chat-input-btn:disabled {
	opacity: 0.4;
	cursor: not-allowed;
}

.ptl-chat-submit-btn:not(:disabled) {
	color: var(--tl-color-selected);
}

.ptl-chat-submit-btn:not(:disabled):hover {
	background: var(--tl-color-selected);
	color: var(--tl-color-selected-contrast);
}

.ptl-chat-cancel-btn {
	color: var(--text-error, #ef4444);
}

.ptl-chat-cancel-btn:hover {
	background: rgba(239, 68, 68, 0.15);
}

/* ============================================
   Chat Actions (Model Selector, Context Selector)
   ============================================ */

.ptl-chat-actions {
	display: flex;
	gap: 8px;
	width: 100%;
	justify-content: space-between;
	font-size: 11px;
	color: var(--tl-color-text-2);
}

.ptl-chat-actions-left {
	display: flex;
	gap: 0px;
}

/* Model Selector */
.ptl-chat-model-select {
	position: relative;
	display: flex;
	align-items: center;
	gap: 4px;
	padding: 0px 8px;
	cursor: pointer;
}

.ptl-chat-model-select-label {
	display: flex;
	align-items: center;
	gap: 2px;
	margin-left: -6px;
}

.ptl-chat-model-select:hover {
	color: var(--tl-color-text);
}

/* Hidden select overlay for native dropdown behavior */
.ptl-chat-model-select select {
	opacity: 0;
	position: absolute;
	left: -1px;
	right: -1px;
	top: 0;
	bottom: 0;
	width: calc(100% + 2px);
	background-color: transparent;
	border-radius: 6px;
	padding: 2px 16px 2px 0px;
	font-size: 11px;
	border: none;
	-webkit-appearance: none;
	-moz-appearance: none;
	appearance: none;
	cursor: pointer;
}

/* Context Selector (Add Context) */
.ptl-chat-context-select {
	position: relative;
	display: flex;
	align-items: center;
	gap: 4px;
	padding: 0px 4px 0px 3px;
	border: 1px solid var(--tl-color-text-2);
	border-radius: 6px;
	height: 18px;
	cursor: pointer;
	font-size: 10px;
	font-weight: 500;
}

.ptl-chat-context-select-label {
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 10px;
}

.ptl-chat-context-select:hover {
	color: var(--tl-color-text);
	border-color: var(--tl-color-text);
}

/* Hidden select for context dropdown */
.ptl-chat-context-select select {
	opacity: 0;
	position: absolute;
	left: -1px;
	right: -1px;
	top: 0;
	bottom: 0;
	width: calc(100% + 2px);
	background-color: transparent;
	border-radius: 6px;
	padding: 2px 16px 2px 0px;
	font-size: 10px;
	border: none;
	-webkit-appearance: none;
	-moz-appearance: none;
	appearance: none;
	cursor: pointer;
	font-weight: 500;
	line-height: 1.5;
}

/* Active state when context tool is active */
.ptl-chat-context-select.active {
	background-color: var(--tl-color-primary);
	color: black;
	border-color: black;
}

.ptl-chat-context-select.active:hover {
	background-color: var(--tl-color-primary);
	color: var(--tl-color-text);
	border-color: var(--tl-color-text);
}

/* Override Obsidian button styles for chat panel buttons */
.tldraw-view-root .ptl-chat-panel button {
	background-color: transparent;
	box-shadow: none;
}

.tldraw-view-root .ptl-chat-panel-toggle-btn {
	background: var(--tl-color-panel);
	box-shadow: var(--tl-shadow-2);
}

.tldraw-view-root .ptl-chat-panel-toggle-btn:hover {
	background: var(--tl-color-muted-2);
}

.tldraw-view-root .ptl-chat-input-btn {
	padding: 0;
}

/* Chat Panel Header Actions */
.ptl-chat-panel-header-actions {
	display: flex;
	align-items: center;
	gap: 2px;
}

.ptl-chat-panel-header-btn {
	width: 24px;
	height: 24px;
	min-width: 24px;
	min-height: 24px;
	border-radius: var(--tl-radius-2);
	background: transparent;
	border: none;
	outline: none;
	cursor: pointer;
	display: flex !important;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-1);
	transition: background-color 0.15s ease;
	visibility: visible !important;
	opacity: 1 !important;
}

.ptl-chat-panel-header-btn:hover {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

.ptl-chat-panel-header-btn svg {
	width: 14px;
	height: 14px;
	display: block;
	stroke: currentColor;
	flex-shrink: 0;
}

/* Chat History - Main container */
.ptl-chat-history {
	flex: 1;
	overflow-y: auto;
	overflow-x: hidden;
	padding: 0px 16px 32px 16px;
	display: flex;
	flex-direction: column;
	gap: 10px;
	position: relative;
	width: 100%;
	scrollbar-width: thin;
	scrollbar-color: var(--tl-color-muted-1) transparent;
	-webkit-user-select: text;
	user-select: text;
}

.ptl-chat-history::-webkit-scrollbar {
	width: 8px;
}

.ptl-chat-history::-webkit-scrollbar-track {
	background: transparent;
}

.ptl-chat-history::-webkit-scrollbar-thumb {
	background: var(--tl-color-muted-1);
	border-radius: 4px;
}

/* Chat Fallback (empty state) */
.ptl-chat-fallback {
	flex: 1;
	display: flex;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-2);
	font-size: 13px;
	text-align: center;
	padding: 20px;
}

.ptl-chat-fallback p {
	margin: 0;
	line-height: 1.5;
}

/* Chat History Section - Groups prompt with its actions */
.ptl-chat-history-section {
	display: flex;
	flex-direction: column;
	gap: 14px;
	flex-shrink: 0;
}

.ptl-chat-history-section:last-child {
	min-height: calc(100% - 1px);
}

/* Chat History Prompt - User's message with sticky positioning */
.ptl-chat-history-prompt-container {
	position: sticky;
	top: -6px;
	padding: 8px;
	margin: -8px;
	z-index: 9999;
	background-color: var(--tl-color-panel);
}

.ptl-chat-history-prompt {
	background-color: var(--tl-color-muted-1);
	box-shadow: var(--tl-shadow-1);
	color: var(--tl-color-text-1);
	width: 100%;
	font-family: 'Inter', sans-serif;
	font-weight: 400;
	font-size: 12px;
	padding: 8px;
	border-radius: 8px;
	display: flex;
	flex-direction: column;
	gap: 4px;
	white-space: pre-wrap;
	max-height: 25vh;
	overflow-y: auto;
	scrollbar-width: thin;
	scrollbar-color: var(--tl-color-text-3) transparent;
	-webkit-user-select: text;
	user-select: text;
	cursor: text;
}

.ptl-chat-history-prompt::-webkit-scrollbar {
	width: 8px;
	background: transparent;
}

.ptl-chat-history-prompt::-webkit-scrollbar-track {
	background: transparent;
}

.ptl-chat-history-prompt::-webkit-scrollbar-thumb {
	background: var(--tl-color-text-3);
	border-radius: 4px;
}

/* ============================================
   Prompt Tags (selection, context)
   ============================================ */

.ptl-prompt-tags {
	display: flex;
	gap: 4px;
	align-items: center;
	flex-wrap: wrap;
}

.ptl-prompt-tag {
	display: flex;
	align-items: center;
	border-radius: 6px;
	background-color: transparent;
	font-size: 10px;
	border: 1px solid var(--tl-color-text-2);
	padding: 8px 4px 8px 3px;
	font-weight: 500;
	height: 16px;
	color: var(--tl-color-text-2);
	white-space: nowrap;
	font-family: 'Inter', sans-serif;
	max-width: 100%;
}

button.ptl-prompt-tag {
	cursor: pointer;
	background: transparent;
	box-shadow: none;
}

button.ptl-prompt-tag:hover {
	color: var(--tl-color-text);
	border-color: var(--tl-color-text);
}

button.ptl-prompt-tag span {
	user-select: none;
}

.ptl-prompt-tag span {
	text-overflow: ellipsis;
	overflow: hidden;
}

.ptl-prompt-tag svg {
	flex-shrink: 0;
}

/* Override Obsidian button styles for prompt tags */
.tldraw-view-root button.ptl-prompt-tag {
	background: transparent;
	box-shadow: none;
	padding: 8px 4px 8px 3px;
}

/* Chat History Group - Groups related actions */
.ptl-chat-history-group {
	display: flex;
	flex-direction: column;
	gap: 14px;
}

/* Collapse Button for thought groups - matches template styling */
.ptl-chat-history-group button.ptl-chat-history-collapse-btn {
	display: flex;
	align-items: center;
	gap: 4px;
	padding: 12px 0px;
	margin: -12px 0px;
	font-size: 12px;
	font-family: 'Inter', sans-serif;
	font-weight: 400;
	color: var(--tl-color-text-2);
	background-color: transparent;
	border: none;
	cursor: pointer;
}

.ptl-chat-history-group button.ptl-chat-history-collapse-btn:hover {
	color: var(--tl-color-text);
}

.ptl-chat-history-group button.ptl-chat-history-collapse-btn:disabled {
	color: var(--tl-color-text-1);
	cursor: default;
}

.ptl-chat-history-collapse-icon {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 14px;
	height: 14px;
	flex-shrink: 0;
}

/* Agent Actions Container */
.ptl-agent-actions-container {
	display: flex;
	flex-direction: column;
	gap: 10px;
}

/* Individual Agent Action */
.ptl-agent-action {
	display: flex;
	align-items: flex-start;
	gap: 4px;
	font-size: 12px;
	font-family: 'Inter', sans-serif;
	font-weight: 400;
	color: var(--tl-color-text-2);
}

.ptl-agent-action-icon {
	flex-shrink: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	width: 14px;
	height: 18px;
	color: var(--tl-color-text-2);
}

.ptl-agent-action-description {
	margin: 0;
	width: 100%;
}

.ptl-agent-action-description > p:first-child {
	margin-top: 0;
}

.ptl-agent-action-description > p:last-child {
	margin-bottom: 0;
}

/* Markdown rendering in action descriptions */
.ptl-agent-action-description p {
	white-space: pre-wrap;
}

.ptl-agent-action-description ul,
.ptl-agent-action-description ol {
	padding-left: 20px;
}

.ptl-agent-action-description pre {
	width: 100%;
	overflow-x: scroll;
}

.ptl-agent-action-description blockquote {
	padding-left: 14px;
	border-left: 2px solid var(--tl-color-text-2);
	margin: 0;
}

.ptl-agent-action-description li {
	margin: 0.25em 0;
}

.ptl-agent-action-description strong {
	font-weight: 600;
}

.ptl-agent-action-description code {
	background: var(--background-modifier-hover);
	padding: 0.1em 0.3em;
	border-radius: 3px;
	font-size: 0.9em;
}

.ptl-agent-action-description pre code {
	background: none;
	padding: 0;
}

/* Message action styling - make it stand out */
.ptl-agent-action-type-message {
	color: var(--tl-color-text-1);
}

/* Spinner */
.ptl-chat-spinner {
	display: flex;
	align-items: center;
	justify-content: flex-start;
	gap: 4px;
	padding: 4px 0;
}

.ptl-chat-spinner-dot {
	font-size: 8px;
	color: var(--tl-color-text-2);
	animation: ptl-chat-pulse 1.4s infinite ease-in-out both;
}

.ptl-chat-spinner-dot:nth-child(1) {
	animation-delay: -0.32s;
}

.ptl-chat-spinner-dot:nth-child(2) {
	animation-delay: -0.16s;
}

/* Override button styles within chat history */
.tldraw-view-root .ptl-chat-history-collapse-btn {
	background: transparent;
	box-shadow: none;
	padding: 12px 0;
}

.tldraw-view-root .ptl-chat-panel-header-btn {
	background: transparent;
	box-shadow: none;
}

/* ============================================
   PDF Import Modal Styles
   ============================================ */

.ptl-pdf-import-modal {
	padding: 20px;
}

.ptl-pdf-import-modal h2 {
	margin-top: 0;
	margin-bottom: 16px;
}

.ptl-pdf-info {
	color: var(--text-muted);
	margin-bottom: 16px;
}

.ptl-pdf-section {
	margin-bottom: 20px;
}

.ptl-pdf-section h3 {
	margin-top: 0;
	margin-bottom: 12px;
	font-size: 14px;
	font-weight: 600;
}

.ptl-pdf-bulk-buttons {
	display: flex;
	gap: 8px;
	margin-bottom: 12px;
}

.ptl-pdf-bulk-buttons button {
	padding: 4px 12px;
	font-size: 12px;
}

.ptl-pdf-range {
	display: flex;
	align-items: center;
	gap: 8px;
	margin-bottom: 12px;
}

.ptl-pdf-range-input {
	flex: 1;
	padding: 4px 8px;
	border: 1px solid var(--background-modifier-border);
	border-radius: 4px;
	background: var(--background-primary);
}

.ptl-pdf-page-list {
	max-height: 200px;
	overflow-y: auto;
	border: 1px solid var(--background-modifier-border);
	border-radius: 4px;
	padding: 8px;
}

.ptl-pdf-page-item {
	display: flex;
	align-items: center;
	gap: 8px;
	padding: 4px 0;
}

.ptl-pdf-page-item input[type="checkbox"] {
	margin: 0;
}

.ptl-pdf-buttons {
	display: flex;
	justify-content: flex-end;
	gap: 8px;
	margin-top: 20px;
	padding-top: 16px;
	border-top: 1px solid var(--background-modifier-border);
}

.ptl-pdf-error {
	color: var(--text-error);
	margin-top: 8px;
}

/* Ensure tldraw menus appear above layer panel */
/* ============================================
   Accept/Reject Change Buttons - Template Style
   ============================================ */

.ptl-chat-history-change {
	display: flex;
	flex-direction: column;
	gap: 0;
}

.ptl-chat-history-change-acceptance {
	display: flex;
	justify-content: flex-end;
	width: 100%;
	gap: 2px;
}

.ptl-chat-history-change-acceptance button {
	border: 0;
	cursor: pointer;
	background-color: var(--tl-color-muted-1);
	color: var(--tl-color-text-2);
	padding: 4px 8px;
	font-size: 10px;
	font-weight: 500;
	height: 20px;
	user-select: none;
	display: flex;
	align-items: center;
	gap: 4px;
	flex-direction: row;
	border-radius: 0;
}

.ptl-chat-history-change-acceptance button:hover {
	color: var(--tl-color-text);
}

.ptl-chat-history-change-acceptance button:disabled {
	color: var(--tl-color-text-1);
	cursor: default;
}

/* First button: top-left radius only */
.ptl-chat-history-change-acceptance button:first-child {
	border-radius: 4px 0px 0px 0px;
}

/* Last button: top-right radius only */
.ptl-chat-history-change-acceptance button:last-child {
	border-radius: 0px 4px 0px 0px;
}

/* ============================================
   Agent Changes (Diff Steps) - Template Style
   ============================================ */

.ptl-agent-changes {
	background-color: var(--tl-color-muted-1);
	padding: 6px 8px;
	margin: 0px 0px;
	border-radius: 4px 0px 0px 0px;
	color: var(--tl-color-text-2);
	max-height: 70px;
	overflow-y: auto;
	scrollbar-width: none;
	-ms-overflow-style: none;
}

.ptl-agent-changes::-webkit-scrollbar {
	display: none;
}

.ptl-agent-changes:last-child {
	border-radius: 4px 0px 4px 4px;
	max-height: 100%;
}

.ptl-agent-change {
	display: flex;
	align-items: flex-start;
	gap: 4px;
	font-size: 12px;
	font-family: 'Inter', sans-serif;
	font-weight: 400;
}

.ptl-agent-change-icon {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 16px;
	height: 16px;
	opacity: 0.7;
}

/* ============================================
   TldrawViewer (Shape Preview)
   ============================================ */

.ptl-tldraw-viewer {
	height: 150px;
	min-height: 150px;
	position: relative;
	border-radius: 8px;
	overflow: hidden;
	background: var(--tl-color-background);
}

.ptl-tldraw-viewer .tlui-tooltip {
	display: none;
}

/* Diff summary (collapsed state) */
.ptl-diff-summary {
	display: flex;
	align-items: center;
	gap: 6px;
	padding: 8px 12px;
	background: var(--color-bg-secondary);
	border: 1px solid var(--color-border);
	border-radius: 6px;
	cursor: pointer;
	font-size: 12px;
	width: 100%;
	text-align: left;
}

.ptl-diff-summary:hover {
	background: var(--color-bg-tertiary);
}

.ptl-diff-summary-stats {
	font-family: var(--font-monospace);
	font-weight: 600;
	color: var(--color-accent);
}

.ptl-diff-summary-label {
	color: var(--color-text-secondary);
}

/* Diff viewer expanded */
.ptl-diff-viewer-expanded {
	display: flex;
	flex-direction: column;
	gap: 4px;
}

.ptl-diff-collapse-btn {
	align-self: flex-start;
	padding: 4px 8px;
	font-size: 11px;
	background: transparent;
	border: none;
	color: var(--color-text-secondary);
	cursor: pointer;
}

.ptl-diff-collapse-btn:hover {
	color: var(--color-text-primary);
}

/* ============================================
   Diff Shape Styling - Template Style
   ============================================ */

/* Created shapes - green glow */
.ptl-diff-shape-create-shadow {
	filter: drop-shadow(
			calc(var(--tl-scale) * 1px) calc(var(--tl-scale) * 1px) 0px rgba(0, 200, 0, 50%)
		)
		drop-shadow(calc(var(--tl-scale) * -1px) calc(var(--tl-scale) * -1px) 0px rgba(0, 200, 0, 50%))
		drop-shadow(calc(var(--tl-scale) * 1px) calc(var(--tl-scale) * -1px) 0px rgba(0, 200, 0, 50%))
		drop-shadow(calc(var(--tl-scale) * -1px) calc(var(--tl-scale) * 1px) 0px rgba(0, 200, 0, 50%));
}

/* Deleted shapes - red glow */
.ptl-diff-shape-delete-shadow {
	filter: drop-shadow(
			calc(var(--tl-scale) * 1px) calc(var(--tl-scale) * 1px) 0px rgba(200, 0, 0, 50%)
		)
		drop-shadow(calc(var(--tl-scale) * -1px) calc(var(--tl-scale) * -1px) 0px rgba(200, 0, 0, 50%))
		drop-shadow(calc(var(--tl-scale) * 1px) calc(var(--tl-scale) * -1px) 0px rgba(200, 0, 0, 50%))
		drop-shadow(calc(var(--tl-scale) * -1px) calc(var(--tl-scale) * 1px) 0px rgba(200, 0, 0, 50%));
}

/* Updated shapes - blue glow */
.ptl-diff-shape-update-after-shadow {
	filter: drop-shadow(
			calc(var(--tl-scale) * 1px) calc(var(--tl-scale) * 1px) 0px rgba(0, 100, 255, 50%)
		)
		drop-shadow(
			calc(var(--tl-scale) * -1px) calc(var(--tl-scale) * -1px) 0px rgba(0, 100, 255, 50%)
		)
		drop-shadow(calc(var(--tl-scale) * 1px) calc(var(--tl-scale) * -1px) 0px rgba(0, 100, 255, 50%))
		drop-shadow(calc(var(--tl-scale) * -1px) calc(var(--tl-scale) * 1px) 0px rgba(0, 100, 255, 50%));
}

/* ============================================
   TodoList Styling - Template Style
   ============================================ */

.ptl-todo-list {
	background-color: var(--tl-color-panel);
	border-radius: 12px 12px 0 0;
	padding: 8px 8px 4px 8px;
	box-shadow: var(--tl-shadow-1);
	border: 1px solid var(--tl-color-muted-2);
	border-bottom: none;
	max-height: 150px;
	overflow-y: auto;
	flex-shrink: 0;
	scrollbar-width: none;
	-ms-overflow-style: none;
	margin-bottom: -4px;
}

.ptl-todo-list::-webkit-scrollbar {
	display: none;
}

.ptl-todo-list-items {
	display: flex;
	flex-direction: column-reverse;
}

.ptl-todo-item {
	display: flex;
	align-items: flex-start;
	gap: 8px;
	padding-left: 4px;
	border-radius: 6px;
	font-size: 12px;
	line-height: 1.3;
}

.ptl-todo-item-icon {
	font-size: 10px;
	width: 12px;
	text-align: center;
	flex-shrink: 0;
	user-select: none;
}

.ptl-todo-item-text {
	flex: 1;
	color: var(--tl-color-text-3);
	user-select: none;
	padding-bottom: 8px;
}

/* Status-specific icon colors */
.ptl-todo-item-todo .ptl-todo-item-icon {
	color: var(--tl-color-text-3);
}

.ptl-todo-item-in-progress .ptl-todo-item-icon {
	color: var(--tl-color-primary);
}

.ptl-todo-item-in-progress .ptl-todo-item-text {
	font-weight: 500;
	color: var(--tl-color-text);
}

.ptl-todo-item-done .ptl-todo-item-icon {
	color: rgb(76, 200, 94);
}

.ptl-todo-item-done .ptl-todo-item-text {
	color: var(--tl-color-text-2);
	text-decoration: line-through;
}

/* Delete button - hidden by default, visible on item hover */
.ptl-todo-item-delete {
	appearance: none;
	background: none;
	border: none;
	width: 16px;
	height: 16px;
	flex-shrink: 0;
	display: flex;
	padding: 12px;
	padding-right: 14px;
	margin-right: -3px;
	margin-top: -3px;
	align-items: center;
	justify-content: center;
	cursor: pointer;
	color: var(--tl-color-text-2);
	opacity: 0;
	transition: opacity 0.15s ease, color 0.15s ease;
}

/* Show delete button on item hover */
.ptl-todo-item:hover .ptl-todo-item-delete {
	opacity: 1;
}

/* Delete button hover state - color change to text-1 */
.ptl-todo-item-delete:hover {
	color: var(--tl-color-text-1);
}

/* Override button styles within todo list */
.tldraw-view-root .ptl-todo-item-delete {
	background: transparent;
	box-shadow: none;
}

/* Override button styles for Accept/Reject */
.tldraw-view-root .ptl-chat-history-change-acceptance button {
	background: var(--tl-color-muted-1);
	box-shadow: none;
}

/* ============================================
   Chat Icon Styles
   ============================================ */

.ptl-chat-icon {
	width: 11px;
	height: 11px;
	margin-right: 4px;
	flex-shrink: 0;
	stroke: currentColor;
}

/* Spinner animation for loading indicator */
.ptl-spinner {
	animation: ptl-spinner-rotate 1s linear infinite;
}

@keyframes ptl-spinner-rotate {
	from {
		transform: rotate(0deg);
	}
	to {
		transform: rotate(360deg);
	}
}

/* ============================================
   Context Highlights - Canvas Overlays
   ============================================ */

/* Base highlight styling - pointer-events none so highlights don't interfere with interactions */
.ptl-context-highlight {
	pointer-events: none;
}

/* Dashed line styling for area highlights */
.ptl-context-highlight line {
	stroke-dasharray: 4px;
	stroke-linecap: round;
	stroke-width: 1px;
}

/* Animated dash when generating/processing */
.ptl-context-highlight-generating line {
	animation: ptl-dash 100s linear infinite;
}

/* Circle styling for point highlights */
.ptl-context-highlight circle {
	stroke-width: 1px;
	pointer-events: none;
	stroke-linecap: round;
	stroke-linejoin: round;
}

/* Animated circle when generating */
.ptl-context-highlight-generating circle {
	stroke-dasharray: 3px;
	stroke-width: 2px;
	fill: none;
	animation: ptl-dash 100s linear infinite;
}

/* Label styling for area highlights (e.g., "Reviewing") */
.ptl-context-highlight-label {
	position: absolute;
	color: var(--tl-color-text-shadow);
	padding: 4px;
	font-size: 12px;
	background-color: var(--tl-color-tooltip);
	border-radius: 0px 0px 6px 0px;
	font-weight: 500;
	white-space: nowrap;
	margin-top: -0.5px;
	margin-left: -0.5px;
	pointer-events: none;
	font-family: 'Inter', sans-serif;
}

/* Dash animation keyframes - moves stroke-dashoffset for animated dashed lines */
@keyframes ptl-dash {
	to {
		stroke-dashoffset: -2000px;
	}
}

/* ============================================
   Comment Navigator Panel
   ============================================ */

.ptl-comment-navigator-wrapper {
	position: absolute;
	left: 88px;
	top: 90px;
	bottom: 60px;
	z-index: 300;
	pointer-events: all;
	display: flex;
	flex-direction: column;
	gap: 4px;
}

.ptl-comment-navigator-toggle-btn {
	width: 32px;
	height: 32px;
	border-radius: var(--tl-radius-2);
	background: var(--tl-color-panel);
	box-shadow: var(--tl-shadow-2);
	border: none;
	outline: none;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-1);
	transition: background-color 0.15s ease;
}

.ptl-comment-navigator-toggle-btn:hover {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

.ptl-comment-navigator {
	width: 280px;
	flex: 1;
	min-height: 0;
	background: var(--tl-color-panel);
	display: flex;
	flex-direction: column;
	border-radius: var(--tl-radius-3);
	box-shadow: var(--tl-shadow-2);
	overflow: hidden;
}

.ptl-comment-navigator-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 8px 10px;
	border-bottom: 1px solid var(--tl-color-divider);
	background: var(--tl-color-panel);
	flex-shrink: 0;
}

.ptl-comment-navigator-title {
	font-size: 12px;
	font-weight: 600;
	color: var(--tl-color-text);
}

/* Comment shape hover effect */
.ptl-comment-shape-container:hover {
	filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.25));
	transform: scale(1.05);
	cursor: pointer;
}

.ptl-comment-navigator-header-actions {
	display: flex;
	align-items: center;
	gap: 2px;
}

.ptl-comment-navigator-header-btn {
	width: 24px;
	height: 24px;
	min-width: 24px;
	min-height: 24px;
	border-radius: var(--tl-radius-2);
	background: transparent;
	border: none;
	outline: none;
	cursor: pointer;
	display: flex !important;
	align-items: center;
	justify-content: center;
	color: var(--tl-color-text-1);
	transition: background-color 0.15s ease;
	visibility: visible !important;
	opacity: 1 !important;
}

.ptl-comment-navigator-header-btn:hover {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

.ptl-comment-navigator-header-btn.active {
	background: var(--tl-color-muted-2);
	color: var(--tl-color-text);
}

.ptl-comment-navigator-header-btn svg {
	width: 14px;
	height: 14px;
	display: block;
	stroke: currentColor;
	flex-shrink: 0;
}

.ptl-comment-navigator-filters {
	display: flex;
	flex-direction: column;
	gap: 6px;
	padding: 8px 10px;
	border-bottom: 1px solid var(--tl-color-divider);
	background: var(--tl-color-panel);
	flex-shrink: 0;
}

.ptl-comment-navigator-search {
	width: 100%;
	padding: 6px 8px;
	border: 1px solid var(--tl-color-divider);
	border-radius: var(--tl-radius-2);
	background: var(--tl-color-background);
	color: var(--tl-color-text);
	font-size: 11px;
	outline: none;
}

.ptl-comment-navigator-search:focus {
	border-color: var(--tl-color-primary);
}

.ptl-comment-navigator-search::placeholder {
	color: var(--tl-color-text-3);
}

.ptl-comment-navigator-filter-row {
	display: flex;
	gap: 6px;
}

.ptl-comment-navigator-filter {
	flex: 1;
	padding: 4px 6px;
	border: 1px solid var(--tl-color-divider);
	border-radius: var(--tl-radius-2);
	background: var(--tl-color-background);
	color: var(--tl-color-text);
	font-size: 10px;
	outline: none;
	cursor: pointer;
}

.ptl-comment-navigator-content {
	flex: 1;
	overflow-y: auto;
	overflow-x: hidden;
}

.ptl-comment-navigator-empty {
	display: flex;
	align-items: center;
	justify-content: center;
	height: 100%;
	padding: 20px;
	color: var(--tl-color-text-3);
	font-size: 11px;
	text-align: center;
}

/* Comment List */
.ptl-comment-list {
	display: flex;
	flex-direction: column;
}

/* Comment Item */
.ptl-comment-item {
	display: flex;
	flex-direction: column;
	gap: 4px;
	padding: 10px;
	border-bottom: 1px solid var(--tl-color-divider);
	cursor: pointer;
	transition: background-color 0.1s ease;
}

.ptl-comment-item:hover {
	background: var(--tl-color-muted-1);
}

.ptl-comment-item:last-child {
	border-bottom: none;
}

.ptl-comment-item-header {
	display: flex;
	align-items: center;
	gap: 6px;
	font-size: 11px;
}

.ptl-comment-author {
	font-weight: 600;
	color: var(--tl-color-text);
}

.ptl-comment-reply-count {
	color: var(--tl-color-text-3);
	font-size: 10px;
}

.ptl-comment-preview {
	font-size: 11px;
	color: var(--tl-color-text-2);
	line-height: 1.4;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.ptl-comment-binding {
	display: flex;
	align-items: center;
	gap: 4px;
	font-size: 10px;
	color: var(--tl-color-text-3);
}

.ptl-comment-binding-icon {
	flex-shrink: 0;
}

.ptl-comment-binding-text {
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

/* Comment Status Icons */
.ptl-comment-status-open {
	color: var(--tl-color-primary);
	flex-shrink: 0;
}

.ptl-comment-status-resolved {
	color: var(--palette-green);
	flex-shrink: 0;
}

/* Override Obsidian button styles for comment navigator */
.tldraw-view-root .ptl-comment-navigator button {
	background-color: transparent;
	box-shadow: none;
}

.tldraw-view-root .ptl-comment-navigator-toggle-btn {
	background: var(--tl-color-panel);
	box-shadow: var(--tl-shadow-2);
}

.tldraw-view-root .ptl-comment-navigator-toggle-btn:hover {
	background: var(--tl-color-muted-2);
}

/* ========================================
   Comment Thread Panel Styles
   ======================================== */

.ptl-comment-thread-panel {
	position: fixed;
	top: 50%;
	right: 20px;
	transform: translateY(-50%);
	width: 400px;
	max-height: 80vh;
	background: var(--background-primary);
	border: 1px solid var(--background-modifier-border);
	border-radius: 8px;
	box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
	display: flex;
	flex-direction: column;
	z-index: 1001;
	overflow: hidden;
	pointer-events: all;
}

.ptl-comment-thread-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 12px 16px;
	border-bottom: 1px solid var(--background-modifier-border);
	background: var(--background-secondary);
}

.ptl-comment-thread-header-left {
	display: flex;
	align-items: center;
	gap: 12px;
	flex: 1;
}

.ptl-comment-thread-title {
	font-size: 14px;
	font-weight: 600;
	color: var(--text-normal);
}

.ptl-comment-thread-status-btn {
	display: flex;
	align-items: center;
	gap: 6px;
	padding: 4px 10px;
	font-size: 12px;
	border: 1px solid var(--background-modifier-border);
	border-radius: 4px;
	background: var(--background-primary);
	color: var(--text-muted);
	cursor: pointer;
	transition: all 0.15s ease;
}

.ptl-comment-thread-status-btn:hover {
	background: var(--background-modifier-hover);
	color: var(--text-normal);
}

.ptl-comment-thread-status-btn.resolved {
	background: var(--color-green);
	color: white;
	border-color: var(--color-green);
}

.ptl-comment-thread-close-btn,
.ptl-comment-thread-delete-btn,
.ptl-comment-thread-bind-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 36px;
	height: 36px;
	border: none;
	background: transparent;
	color: var(--text-muted);
	cursor: pointer;
	border-radius: 4px;
	transition: all 0.15s ease;
}

.ptl-comment-thread-close-btn svg,
.ptl-comment-thread-delete-btn svg,
.ptl-comment-thread-bind-btn svg {
	width: 20px;
	height: 20px;
}

.ptl-comment-thread-close-btn:hover,
.ptl-comment-thread-delete-btn:hover,
.ptl-comment-thread-bind-btn:hover {
	background: var(--background-modifier-hover);
	color: var(--text-normal);
}

.ptl-comment-thread-delete-btn:hover {
	color: var(--text-error);
}

.ptl-comment-thread-bind-btn.bound {
	color: var(--interactive-accent);
}

.ptl-comment-thread-bind-btn:not(.bound) {
	cursor: grab;
}

.ptl-comment-thread-bind-btn.bound:hover {
	color: var(--text-error);
	cursor: pointer;
}

.ptl-comment-thread-bind-btn.dragging {
	opacity: 0.5;
	cursor: grabbing;
}

@keyframes pulse {
	0%, 100% {
		opacity: 1;
	}
	50% {
		opacity: 0.7;
	}
}

.ptl-comment-thread-metadata {
	padding: 12px 16px;
	border-bottom: 1px solid var(--background-modifier-border);
	font-size: 13px;
}

.ptl-comment-thread-author {
	color: var(--text-normal);
	margin-bottom: 4px;
}

.ptl-comment-thread-date {
	color: var(--text-muted);
	font-size: 12px;
}

.ptl-comment-thread-binding {
	color: var(--text-muted);
	font-size: 12px;
	margin-top: 4px;
	font-style: italic;
}

.ptl-comment-thread-content {
	flex: 1;
	overflow-y: auto;
	padding: 16px;
}

.ptl-comment-thread-input-area {
	padding: 12px 16px;
	border-top: 1px solid var(--background-modifier-border);
	background: var(--background-secondary);
}

/* ========================================
   Reply List Styles
   ======================================== */

.ptl-reply-list {
	display: flex;
	flex-direction: column;
	gap: 16px;
}

.ptl-reply-list-empty {
	text-align: center;
	padding: 32px 16px;
	color: var(--text-muted);
	font-size: 13px;
	font-style: italic;
}

.ptl-reply-item {
	padding: 12px;
	border-radius: 6px;
	background: var(--background-secondary);
	border: 1px solid var(--background-modifier-border);
}

.ptl-reply-item.ai-reply {
	background: var(--color-blue-faint);
	border-color: var(--color-blue);
}

.ptl-reply-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 8px;
}

.ptl-reply-author {
	display: flex;
	align-items: center;
	gap: 6px;
	font-size: 13px;
	color: var(--text-normal);
}

.ptl-reply-author svg {
	width: 14px;
	height: 14px;
	color: var(--color-blue);
}

.ptl-reply-actions {
	display: flex;
	align-items: center;
	gap: 4px;
}

.ptl-reply-action-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 20px;
	height: 20px;
	border: none;
	background: transparent;
	color: var(--text-muted);
	cursor: pointer;
	border-radius: 3px;
	transition: all 0.15s ease;
	padding: 0;
}

.ptl-reply-action-btn:hover {
	background: var(--background-modifier-hover);
	color: var(--text-normal);
}

.ptl-reply-delete-btn:hover {
	color: var(--text-error);
}

.ptl-reply-save-btn:hover {
	color: var(--color-green);
}

.ptl-reply-timestamp {
	font-size: 11px;
	color: var(--text-muted);
}

.ptl-reply-edit-textarea {
	width: 100%;
	min-height: 60px;
	padding: 8px;
	border: 1px solid var(--background-modifier-border);
	border-radius: 4px;
	background: var(--background-primary);
	color: var(--text-normal);
	font-size: 13px;
	font-family: var(--font-text);
	resize: vertical;
	outline: none;
}

.ptl-reply-edit-textarea:focus {
	border-color: var(--interactive-accent);
}

.ptl-reply-message {
	font-size: 13px;
	line-height: 1.6;
	color: var(--text-normal);
	word-wrap: break-word;
}

.ptl-reply-message-text {
	white-space: pre-wrap;
}

/* Mention Styles */
.ptl-reply-mention {
	display: inline-flex;
	align-items: center;
	gap: 3px;
	padding: 2px 6px;
	border-radius: 3px;
	font-size: 12px;
	font-weight: 500;
	text-decoration: none;
	transition: all 0.15s ease;
}

.ptl-reply-mention-shape {
	background: var(--color-blue-faint);
	color: var(--color-blue);
	border: 1px solid var(--color-blue);
	cursor: pointer;
}

.ptl-reply-mention-shape:hover {
	background: var(--color-blue);
	color: white;
}

.ptl-reply-mention-user {
	background: var(--color-purple-faint);
	color: var(--color-purple);
	border: 1px solid var(--color-purple);
}

.ptl-reply-mention-agent {
	background: var(--color-green-faint);
	color: var(--color-green);
	border: 1px solid var(--color-green);
	display: inline-flex;
	align-items: center;
	gap: 3px;
}

.ptl-reply-mention-agent svg {
	width: 12px;
	height: 12px;
}

/* ========================================
   Reply Input Styles
   ======================================== */

.ptl-reply-input-container {
	position: relative;
}

.ptl-reply-input-header {
	margin-bottom: 8px;
}

.ptl-reply-input-user {
	font-size: 12px;
	color: var(--text-muted);
}

.ptl-reply-input-row {
	display: flex;
	align-items: flex-end;
	gap: 8px;
}

.ptl-reply-input-textarea {
	flex: 1;
	min-height: 36px;
	max-height: 120px;
	padding: 8px 12px;
	border: 1px solid var(--background-modifier-border);
	border-radius: 4px;
	background: var(--background-primary);
	color: var(--text-normal);
	font-size: 13px;
	font-family: var(--font-text);
	resize: none;
	overflow-y: auto;
}

.ptl-reply-input-textarea:focus {
	outline: none;
	border-color: var(--color-blue);
}

.ptl-reply-input-textarea::placeholder {
	color: var(--text-faint);
}

.ptl-reply-input-actions {
	display: flex;
	align-items: center;
	gap: 4px;
}

.ptl-reply-input-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 36px;
	height: 36px;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	transition: all 0.15s ease;
}

.ptl-reply-submit-btn {
	background: var(--color-blue);
	color: white;
}

.ptl-reply-submit-btn:hover:not(:disabled) {
	background: var(--color-blue-hover);
}

.ptl-reply-submit-btn:disabled {
	opacity: 0.4;
	cursor: not-allowed;
}

.ptl-reply-cancel-btn {
	background: var(--background-modifier-hover);
	color: var(--text-muted);
	font-size: 20px;
	width: 32px;
	height: 32px;
}

.ptl-reply-cancel-btn:hover {
	background: var(--background-modifier-border);
	color: var(--text-normal);
}

/* ========================================
   Mention Autocomplete Styles
   ======================================== */

.ptl-mention-autocomplete {
	position: absolute;
	bottom: 100%;
	left: 0;
	right: 0;
	margin-bottom: 8px;
	max-height: 300px;
	overflow-y: auto;
	background: var(--background-primary);
	border: 1px solid var(--background-modifier-border);
	border-radius: 6px;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	z-index: 1002;
	padding: 4px 0;
}

.ptl-mention-autocomplete-empty {
	padding: 16px;
	text-align: center;
	color: var(--text-muted);
	font-size: 13px;
}

.ptl-mention-group {
	padding: 8px 0;
	border-bottom: 1px solid var(--background-modifier-border);
}

.ptl-mention-group:last-child {
	border-bottom: none;
}

.ptl-mention-group-header {
	padding: 6px 12px;
	font-size: 11px;
	font-weight: 600;
	color: var(--text-muted);
	text-transform: uppercase;
	letter-spacing: 0.5px;
}

.ptl-mention-option {
	display: flex;
	align-items: center;
	gap: 10px;
	width: 100%;
	padding: 8px 12px;
	border: none;
	background: transparent;
	color: var(--text-normal);
	font-size: 13px;
	text-align: left;
	cursor: pointer;
	transition: background 0.15s ease;
}

.ptl-mention-option:hover,
.ptl-mention-option.selected {
	background: var(--background-modifier-hover);
}

.ptl-mention-option svg {
	width: 16px;
	height: 16px;
	min-width: 16px;
	min-height: 16px;
	flex-shrink: 0;
	display: block;
}

.ptl-mention-color-badge {
	width: 12px;
	height: 12px;
	border-radius: 50%;
	flex-shrink: 0;
	border: 1px solid var(--background-modifier-border);
}

.ptl-mention-option-name {
	flex: 1;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.ptl-mention-option-name.ptl-mention-placeholder {
	color: var(--text-faint);
	font-style: italic;
	opacity: 0.6;
}

.ptl-mention-group-footer {
	padding: 6px 12px;
	font-size: 11px;
	color: var(--text-faint);
	font-style: italic;
	text-align: center;
}
